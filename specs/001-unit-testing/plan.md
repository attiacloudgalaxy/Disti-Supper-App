# Implementation Plan: Unit Testing Infrastructure

**Branch**: `001-unit-testing` | **Date**: 2025-01-17 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-unit-testing/spec.md`

## Summary

Establish a comprehensive unit testing infrastructure for DistributorHub using Vitest (optimized for Vite) and React Testing Library. This includes test configuration, coverage reporting, API mocking with MSW, Redux state testing, and accessibility testing with vitest-axe. The infrastructure will enable developers to write, run, and maintain tests for React components, services, and utilities with fast feedback loops.

## Technical Context

**Language/Version**: JavaScript (ES2022+), React 18.2.0, Node.js 18+
**Primary Dependencies**: Vite 5.4.21, React 18.2.0, Redux Toolkit 2.6.1, React Router 6.30.3, Supabase
**Storage**: Supabase (PostgreSQL) - mocked in tests
**Testing**: Vitest + React Testing Library + MSW + vitest-axe
**Target Platform**: Web (SPA), GitHub Pages deployment
**Project Type**: Single frontend web application
**Performance Goals**: Full test suite < 60 seconds, watch mode feedback < 5 seconds
**Constraints**: Tests must not require network access; jsdom environment for DOM testing
**Scale/Scope**: ~102 JS/JSX files, 9 service files, 12 feature modules

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Verification |
|-----------|--------|--------------|
| I. Test-First Development | PASS | Infrastructure enables TDD; coverage thresholds enforce 80% minimum |
| II. Component Isolation | PASS | React Testing Library + jsdom enables isolated component testing |
| III. Service Layer Testing | PASS | MSW mocking enables comprehensive service tests with all failure scenarios |
| IV. Integration Testing | PASS | Structure supports integration tests in `src/__tests__/integration/` |
| V. Accessibility and Performance | PASS | vitest-axe integration for automated a11y checks |

**Technology Stack Alignment**:
- Testing Framework: Vitest (matches constitution spec)
- Component Testing: React Testing Library (matches constitution spec)
- Mocking: MSW (matches constitution spec)
- Accessibility: vitest-axe (Vitest-compatible fork of jest-axe)
- Coverage: V8 via Vitest (faster than Istanbul with equivalent accuracy)

**Coverage Requirements Alignment**:
| Category | Constitution Requirement | Plan Target |
|----------|------------------------|-------------|
| Components | 80% | 80% |
| Services | 90% | 90% |
| Utils | 95% | 95% |
| Overall | 80% | 80% |

## Project Structure

### Documentation (this feature)

```text
specs/001-unit-testing/
├── plan.md              # This file
├── research.md          # Phase 0 output - technology decisions
├── data-model.md        # Phase 1 output - test entities and patterns
├── quickstart.md        # Phase 1 output - developer guide
├── contracts/           # Phase 1 output - test patterns and templates
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/
├── components/
│   ├── ui/                       # Reusable UI components
│   │   ├── Button.jsx
│   │   ├── Button.test.jsx       # NEW: Component test
│   │   └── ...
│   └── navigation/
│       ├── NavigationSidebar.jsx
│       ├── NavigationSidebar.test.jsx  # NEW: Component test
│       └── ...
├── pages/                        # Feature modules
│   └── {feature-name}/
│       ├── components/
│       │   ├── Component.jsx
│       │   └── Component.test.jsx     # NEW: Component test
│       └── index.jsx
├── services/
│   ├── authService.js
│   ├── authService.test.js       # NEW: Service test
│   ├── dealService.js
│   ├── dealService.test.js       # NEW: Service test
│   └── ...
├── contexts/
│   ├── AuthContext.jsx
│   └── AuthContext.test.jsx      # NEW: Context test
├── utils/
│   ├── validators.js
│   └── validators.test.js        # NEW: Utility test
├── __tests__/                    # NEW: Integration tests
│   └── integration/
│       ├── authentication.test.jsx
│       └── dealManagement.test.jsx
└── __mocks__/                    # NEW: MSW handlers
    ├── handlers.js
    └── server.js

# Root configuration files
├── vitest.config.js              # NEW: Vitest configuration
├── vitest.setup.js               # NEW: Test setup (jsdom, MSW, matchers)
└── package.json                  # Updated: test scripts
```

**Structure Decision**: Co-located tests (Component.test.jsx next to Component.jsx) following constitution guidelines, with integration tests in `src/__tests__/integration/` for cross-feature testing.

## Complexity Tracking

> No constitution violations requiring justification.

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A | N/A | N/A |

---

## Post-Design Constitution Check

*Re-evaluated after Phase 1 design completion.*

| Principle | Status | Design Verification |
|-----------|--------|---------------------|
| I. Test-First Development | PASS | Vitest config includes coverage thresholds (80%); quickstart.md documents TDD workflow |
| II. Component Isolation | PASS | Test patterns demonstrate isolated component testing with custom render wrapper |
| III. Service Layer Testing | PASS | MSW handlers organized by domain; service-test-pattern.md covers all error scenarios |
| IV. Integration Testing | PASS | integration-test-pattern.md provides templates for user journeys |
| V. Accessibility and Performance | PASS | vitest-axe pattern included in component-test-pattern.md |

**Design Artifacts Completed**:
- [x] research.md - Technology decisions documented
- [x] data-model.md - Test entities and file inventory
- [x] contracts/ - Test pattern templates
  - [x] component-test-pattern.md
  - [x] service-test-pattern.md
  - [x] integration-test-pattern.md
  - [x] vitest-config-template.md
- [x] quickstart.md - Developer documentation

**Ready for Phase 2**: Task generation via `/speckit.tasks`
